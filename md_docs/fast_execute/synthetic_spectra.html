

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>jupyter: jupytext: formats: ipynb,md text_representation: extension: .md format_name: markdown format_version: ‘1.2’ jupytext_version: 1.7.1 kernelspec: display_name: Python 3 language: python name: python3 &mdash; The Multi-Mission Maximum Likelihood framework  documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/gallery.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^0.21.0-alpha.0/dist/embed-amd.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
  <link rel="stylesheet" href="../../_static/pygments/default.css" type="text/css" id="pygments-style">
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css">
   

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> The Multi-Mission Maximum Likelihood framework
          

          
            
            <img src="../../_static/logo.png" class="logo" alt="Logo"/>
          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../notebooks/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../intro.html">Intro</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../notebooks/configuration.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../notebooks/logging.html">Logging and Verbosity</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../xspec_users.html">Notes for XSPEC Users</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../notebooks/Bayesian_tutorial.html">Bayesian Posterior Sampling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../plugins.html">Plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../modeling.html">Modeling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/API.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/API.html#threeml">threeML</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../release_notes.html">Release Notes</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Features and examples:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../notebooks/Analysis_results_showcase.html">Analysis Results</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../notebooks/random_variates.html">Random Variates</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../notebooks/Point_source_plotting.html">Point source plotting basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../notebooks/Building_Plugins_from_TimeSeries.html">Constructing plugins from TimeSeries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../notebooks/grb080916C.html">Analyzing GRB 080916C</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../notebooks/joint_BAT_gbm_demo.html">Example joint fit between GBM and Swift BAT</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../notebooks/joint_fitting_xrt_and_gbm_xspec_models.html">Joint fitting XRT and GBM data with XSPEC models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../notebooks/flux_examples.html">Point Source Fluxes and Multiple Sources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../notebooks/Time-energy-fit.html">Time-energy fit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../notebooks/synthetic_spectra.html">Generating Synthetic Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../notebooks/gof_lrt.html">Goodness of Fit and Model Comparison</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../notebooks/APEC_doc.html">Fitting XMM-Newton data with the APEC model</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">The Multi-Mission Maximum Likelihood framework</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
  <!--
  <div class="admonition note">
    <p><a href="https://github.com/lukelbd">ProPlot author here</a>: Due to my day job as a graduate student, certain <a href="https://github.com/lukelbd/proplot/pulls?q=is%3Aopen+is%3Apr">feature additions</a> may be delayed to the summer of 2020. In the meantime, if you are interested in contributing to ProPlot, please see the <a href="https://proplot.readthedocs.io/en/latest/contributions.html">contribution guide</a>. Any amount of help is welcome!
    </p>
  </div>
  -->
  <li id="lightdark-li">
    <label for="lightdark-checkbox" id="lightdark-label">
      <input type="checkbox" id="lightdark-checkbox"/>
      <div class="btn-neutral"></div>
    </label>
  </li>
  
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>jupyter:
jupytext:
formats: ipynb,md
text_representation:
extension: .md
format_name: markdown
format_version: ‘1.2’
jupytext_version: 1.7.1
kernelspec:
display_name: Python 3
language: python
name: python3</li>
    

    
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
  <script type="text/javascript" src=../../_static/custom.js></script>
  
           <div itemprop="articleBody">
            
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<hr class="docutils" />
<div class="section" id="jupyter-jupytext-formats-ipynb-md-text-representation-extension-md-format-name-markdown-format-version-1-2-jupytext-version-1-7-1-kernelspec-display-name-python-3-language-python-name-python3">
<h1>jupyter:
jupytext:
formats: ipynb,md
text_representation:
extension: .md
format_name: markdown
format_version: ‘1.2’
jupytext_version: 1.7.1
kernelspec:
display_name: Python 3
language: python
name: python3<a class="headerlink" href="#jupyter-jupytext-formats-ipynb-md-text-representation-extension-md-format-name-markdown-format-version-1-2-jupytext-version-1-7-1-kernelspec-display-name-python-3-language-python-name-python3" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="generating-synthetic-data">
<h1>Generating Synthetic Data<a class="headerlink" href="#generating-synthetic-data" title="Permalink to this headline">¶</a></h1>
<p>In data analysis, it is important that we have the ability to test our assumptions. One powerful tool to enable these tests is simulation. In 3ML, we have several ways to generate synthetic data sets both from models and from fits.</p>
<div class="section" id="synthetic-data-from-spectra">
<h2>Synthetic data from spectra<a class="headerlink" href="#synthetic-data-from-spectra" title="Permalink to this headline">¶</a></h2>
<div class="section" id="genertating-data-from-models">
<h3>Genertating data from models<a class="headerlink" href="#genertating-data-from-models" title="Permalink to this headline">¶</a></h3>
<p>Most of the current plugins support the ability to generate synthetic data directly from a model. This can be very useful to assertain the detectability of a source/component/line or simply to see how models look once they are transformed into data. Below we will demonstrate how different plugins transform a model into synthetic data.</p>
<div class="section" id="xylike">
<h4>XYLike<a class="headerlink" href="#xylike" title="Permalink to this headline">¶</a></h4>
<p>In many of the examples, the basic XYLike plugin has been used to generate synthetic data. Here, we will revisit the plugin for completeness.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="n">np</span><span class="o">.</span><span class="n">seterr</span><span class="p">(</span><span class="nb">all</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">threeML</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">threeML.io.package_data</span> <span class="kn">import</span> <span class="n">get_path_of_data_file</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">jupyterthemes</span> <span class="kn">import</span> <span class="n">jtplot</span>
<span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
<span class="n">jtplot</span><span class="o">.</span><span class="n">style</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="s2">&quot;talk&quot;</span><span class="p">,</span> <span class="n">fscale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ticks</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">grid</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">set_threeML_style</span><span class="p">()</span>
<span class="n">silence_warnings</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Select an astromodels function to from which to simualte</span>
<span class="n">generating_function</span> <span class="o">=</span> <span class="n">Powerlaw</span><span class="p">(</span><span class="n">K</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">index</span><span class="o">=-</span><span class="mi">2</span><span class="p">,</span> <span class="n">piv</span><span class="o">=</span><span class="mf">10.0</span><span class="p">)</span>

<span class="c1"># set up the x grig points</span>
<span class="n">x_points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>

<span class="c1"># call the from_function classmethod</span>
<span class="n">xyl_generator</span> <span class="o">=</span> <span class="n">XYLike</span><span class="o">.</span><span class="n">from_function</span><span class="p">(</span>
    <span class="s2">&quot;sim_data&quot;</span><span class="p">,</span>
    <span class="n">function</span><span class="o">=</span><span class="n">generating_function</span><span class="p">,</span>
    <span class="n">x</span><span class="o">=</span><span class="n">x_points</span><span class="p">,</span>
    <span class="n">yerr</span><span class="o">=</span><span class="mf">0.3</span> <span class="o">*</span> <span class="n">generating_function</span><span class="p">(</span><span class="n">x_points</span><span class="p">),</span>
<span class="p">)</span>


<span class="n">fig</span> <span class="o">=</span> <span class="n">xyl_generator</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_scale</span><span class="o">=</span><span class="s2">&quot;log&quot;</span><span class="p">,</span> <span class="n">y_scale</span><span class="o">=</span><span class="s2">&quot;log&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="spectrumlike">
<h4>SpectrumLike<a class="headerlink" href="#spectrumlike" title="Permalink to this headline">¶</a></h4>
<p>Generating synthetic spectra from SpectrumLike (non-energy dispersed count spectra) can take many forms with different inputs.</p>
<p>First, let’s set the energy bins we will use for all generated spectra</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
<span class="n">energies</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">51</span><span class="p">)</span>

<span class="c1"># create the low and high energy bin edges</span>
<span class="n">low_edge</span> <span class="o">=</span> <span class="n">energies</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">high_edge</span> <span class="o">=</span> <span class="n">energies</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
</pre></div>
</div>
<p>Now, let’s use a blackbody for the source spectrum.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># get a BPL source function</span>
<span class="n">source_function</span> <span class="o">=</span> <span class="n">Blackbody</span><span class="p">(</span><span class="n">K</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">kT</span> <span class="o">=</span> <span class="mf">5.</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="poisson-spectrum-with-no-background">
<h5>Poisson spectrum with no background<a class="headerlink" href="#poisson-spectrum-with-no-background" title="Permalink to this headline">¶</a></h5>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">spectrum_generator</span> <span class="o">=</span> <span class="n">SpectrumLike</span><span class="o">.</span><span class="n">from_function</span><span class="p">(</span><span class="s1">&#39;fake&#39;</span><span class="p">,</span>
                                               <span class="n">source_function</span><span class="o">=</span><span class="n">source_function</span><span class="p">,</span>
                                               <span class="n">energy_min</span><span class="o">=</span><span class="n">low_edge</span><span class="p">,</span>
                                               <span class="n">energy_max</span><span class="o">=</span><span class="n">high_edge</span><span class="p">)</span>


<span class="n">fig</span> <span class="o">=</span> <span class="n">spectrum_generator</span><span class="o">.</span><span class="n">view_count_spectrum</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="section" id="gaussian-spectrum-with-no-background">
<h5>Gaussian spectrum with no background<a class="headerlink" href="#gaussian-spectrum-with-no-background" title="Permalink to this headline">¶</a></h5>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">spectrum_generator</span> <span class="o">=</span> <span class="n">SpectrumLike</span><span class="o">.</span><span class="n">from_function</span><span class="p">(</span><span class="s1">&#39;fake&#39;</span><span class="p">,</span>
                                               <span class="n">source_function</span><span class="o">=</span><span class="n">source_function</span><span class="p">,</span>
                                               <span class="n">source_errors</span><span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">source_function</span><span class="p">(</span><span class="n">low_edge</span><span class="p">),</span>
                                               <span class="n">energy_min</span><span class="o">=</span><span class="n">low_edge</span><span class="p">,</span>
                                               <span class="n">energy_max</span><span class="o">=</span><span class="n">high_edge</span><span class="p">)</span>


<span class="n">fig</span> <span class="o">=</span> <span class="n">spectrum_generator</span><span class="o">.</span><span class="n">view_count_spectrum</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="section" id="poisson-spectrum-with-poisson-background">
<h5>Poisson spectrum with Poisson Background<a class="headerlink" href="#poisson-spectrum-with-poisson-background" title="Permalink to this headline">¶</a></h5>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
<span class="c1"># power law background function</span>
<span class="n">background_function</span> <span class="o">=</span> <span class="n">Powerlaw</span><span class="p">(</span><span class="n">K</span><span class="o">=</span><span class="mf">.7</span><span class="p">,</span><span class="n">index</span><span class="o">=-</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">piv</span><span class="o">=</span><span class="mf">10.</span><span class="p">)</span>

<span class="n">spectrum_generator</span> <span class="o">=</span> <span class="n">SpectrumLike</span><span class="o">.</span><span class="n">from_function</span><span class="p">(</span><span class="s1">&#39;fake&#39;</span><span class="p">,</span>
                                               <span class="n">source_function</span><span class="o">=</span><span class="n">source_function</span><span class="p">,</span>
                                               <span class="n">background_function</span><span class="o">=</span><span class="n">background_function</span><span class="p">,</span>
                                               <span class="n">energy_min</span><span class="o">=</span><span class="n">low_edge</span><span class="p">,</span>
                                               <span class="n">energy_max</span><span class="o">=</span><span class="n">high_edge</span><span class="p">)</span>


<span class="n">fig</span> <span class="o">=</span> <span class="n">spectrum_generator</span><span class="o">.</span><span class="n">view_count_spectrum</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="section" id="poisson-spectrum-with-gaussian-background">
<h5>Poisson spectrum with Gaussian background<a class="headerlink" href="#poisson-spectrum-with-gaussian-background" title="Permalink to this headline">¶</a></h5>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
<span class="n">spectrum_generator</span> <span class="o">=</span> <span class="n">SpectrumLike</span><span class="o">.</span><span class="n">from_function</span><span class="p">(</span><span class="s1">&#39;fake&#39;</span><span class="p">,</span>
                                               <span class="n">source_function</span><span class="o">=</span><span class="n">source_function</span><span class="p">,</span>
                                               <span class="n">background_function</span><span class="o">=</span><span class="n">background_function</span><span class="p">,</span>
                                               <span class="n">background_errors</span><span class="o">=</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">background_function</span><span class="p">(</span><span class="n">low_edge</span><span class="p">),</span>
                                               <span class="n">energy_min</span><span class="o">=</span><span class="n">low_edge</span><span class="p">,</span>
                                               <span class="n">energy_max</span><span class="o">=</span><span class="n">high_edge</span><span class="p">)</span>


<span class="n">fig</span> <span class="o">=</span> <span class="n">spectrum_generator</span><span class="o">.</span><span class="n">view_count_spectrum</span><span class="p">();</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="dispersionspectrumlike">
<h4>DispersionSpectrumLike<a class="headerlink" href="#dispersionspectrumlike" title="Permalink to this headline">¶</a></h4>
<p>DispersionSpectrumLike behaves in the same fashion as SpectrumLike except that a 3ML Instrument response must be set which means that the energy bins do not need to be specified as they are derived from the response</p>
<p>Let’s grab a response from an instrument.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">threeML.io.package_data</span> <span class="kn">import</span> <span class="n">get_path_of_data_file</span>
<span class="kn">from</span> <span class="nn">threeML.utils.OGIP.response</span> <span class="kn">import</span> <span class="n">OGIPResponse</span>

<span class="c1"># we will use a demo response</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">OGIPResponse</span><span class="p">(</span><span class="n">get_path_of_data_file</span><span class="p">(</span><span class="s2">&quot;datasets/ogip_powerlaw.rsp&quot;</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># rescale the functions for the response</span>
<span class="n">source_function</span> <span class="o">=</span> <span class="n">Blackbody</span><span class="p">(</span><span class="n">K</span><span class="o">=</span><span class="mf">1e-7</span><span class="p">,</span> <span class="n">kT</span><span class="o">=</span><span class="mf">500.0</span><span class="p">)</span>
<span class="n">background_function</span> <span class="o">=</span> <span class="n">Powerlaw</span><span class="p">(</span><span class="n">K</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">index</span><span class="o">=-</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">piv</span><span class="o">=</span><span class="mf">1.0e3</span><span class="p">)</span>
<span class="n">spectrum_generator</span> <span class="o">=</span> <span class="n">DispersionSpectrumLike</span><span class="o">.</span><span class="n">from_function</span><span class="p">(</span>
    <span class="s2">&quot;fake&quot;</span><span class="p">,</span>
    <span class="n">source_function</span><span class="o">=</span><span class="n">source_function</span><span class="p">,</span>
    <span class="n">background_function</span><span class="o">=</span><span class="n">background_function</span><span class="p">,</span>
    <span class="n">response</span><span class="o">=</span><span class="n">response</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python tags=[&quot;nbsphinx-thumbnail&quot;] notranslate"><div class="highlight"><pre><span></span>fig = spectrum_generator.view_count_spectrum()
</pre></div>
</div>
</div>
</div>
<div class="section" id="generating-spectra-from-fitted-models">
<h3>Generating spectra from fitted models<a class="headerlink" href="#generating-spectra-from-fitted-models" title="Permalink to this headline">¶</a></h3>
<p>When performing goodness of fit tests, likelihood ratio tests (both automatic in 3ML) or posterior predictive checks, we need to generate synthetic data from our fitted models. Therefore, we proved methods to do this for most current plugins.</p>
<div class="section" id="id1">
<h4>XYLike<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h4>
<p>Let’s load some example, generic XY data and fit it with a power law.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">data_path</span> <span class="o">=</span> <span class="n">get_path_of_data_file</span><span class="p">(</span><span class="s2">&quot;datasets/xy_powerlaw.txt&quot;</span><span class="p">)</span>


<span class="n">xyl</span> <span class="o">=</span> <span class="n">XYLike</span><span class="o">.</span><span class="n">from_text_file</span><span class="p">(</span><span class="s2">&quot;xyl&quot;</span><span class="p">,</span> <span class="n">data_path</span><span class="p">)</span>

<span class="n">fit_function</span> <span class="o">=</span> <span class="n">Powerlaw</span><span class="p">()</span>

<span class="n">xyl</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">fit_function</span><span class="p">)</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">xyl</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_scale</span><span class="o">=</span><span class="s2">&quot;log&quot;</span><span class="p">,</span> <span class="n">y_scale</span><span class="o">=</span><span class="s2">&quot;log&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>Once our fit has been finished, we can produce simulated data sets from those model parameters.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">synthetic_xyl</span> <span class="o">=</span> <span class="n">xyl</span><span class="o">.</span><span class="n">get_simulated_dataset</span><span class="p">()</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">synthetic_xyl</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_scale</span><span class="o">=</span><span class="s2">&quot;log&quot;</span><span class="p">,</span> <span class="n">y_scale</span><span class="o">=</span><span class="s2">&quot;log&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="spectrumlike-and-dispersionspectrumlike-ogiplike">
<h4>SpectrumLike and DispersionSpectrumLike (OGIPLike)<a class="headerlink" href="#spectrumlike-and-dispersionspectrumlike-ogiplike" title="Permalink to this headline">¶</a></h4>
<p>Both spectrum plugins work in the same way when generating data from a fit. They both keep track of the statistical properties of the likelihoods in the plugin so that the simulated datasets have the appropriate statistical properties. Additionally, background, responsses, etc. are simulated and/or kept track of as well.</p>
<p>Let’s fit an example energy dispersed spectrum.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ogip_data</span> <span class="o">=</span> <span class="n">OGIPLike</span><span class="p">(</span>
    <span class="s2">&quot;ogip&quot;</span><span class="p">,</span>
    <span class="n">observation</span><span class="o">=</span><span class="n">get_path_of_data_file</span><span class="p">(</span><span class="s2">&quot;datasets/ogip_powerlaw.pha&quot;</span><span class="p">),</span>
    <span class="n">background</span><span class="o">=</span><span class="n">get_path_of_data_file</span><span class="p">(</span><span class="s2">&quot;datasets/ogip_powerlaw.bak&quot;</span><span class="p">),</span>
    <span class="n">response</span><span class="o">=</span><span class="n">get_path_of_data_file</span><span class="p">(</span><span class="s2">&quot;datasets/ogip_powerlaw.rsp&quot;</span><span class="p">),</span>
<span class="p">)</span>

<span class="n">ogip_data</span><span class="o">.</span><span class="n">view_count_spectrum</span><span class="p">()</span>
<span class="c1"># define the function</span>
<span class="n">fit_function</span> <span class="o">=</span> <span class="n">Cutoff_powerlaw</span><span class="p">(</span><span class="n">K</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">xc</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">index</span><span class="o">=-</span><span class="mf">0.66</span><span class="p">)</span>

<span class="c1"># define the point source</span>
<span class="n">point_source</span> <span class="o">=</span> <span class="n">PointSource</span><span class="p">(</span><span class="s2">&quot;ps&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">spectral_shape</span><span class="o">=</span><span class="n">fit_function</span><span class="p">)</span>

<span class="c1"># define the model</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">point_source</span><span class="p">)</span>

<span class="n">ogip_data</span><span class="o">.</span><span class="n">set_model</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
</pre></div>
</div>
<p>Now we can now generate synthetic datasets from the fitted model. This will include the background sampled properly from the profile likelihood. The instrument response is automatically passed to the new plugin.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">synthetic_ogip</span> <span class="o">=</span> <span class="n">ogip_data</span><span class="o">.</span><span class="n">get_simulated_dataset</span><span class="p">()</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">synthetic_ogip</span><span class="o">.</span><span class="n">view_count_spectrum</span><span class="p">();</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>

          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2017--2021, G.Vianello, J. M. Burgess, N. Di Lalla, N. Omodei, H. Fleischhack.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>