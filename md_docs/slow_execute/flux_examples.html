

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>jupyter: jupytext: formats: ipynb,md text_representation: extension: .md format_name: markdown format_version: ‘1.2’ jupytext_version: 1.7.1 kernelspec: display_name: Python 3 language: python name: python3 &mdash; The Multi-Mission Maximum Likelihood framework  documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/gallery.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^0.21.0-alpha.0/dist/embed-amd.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
  <link rel="stylesheet" href="../../_static/pygments/default.css" type="text/css" id="pygments-style">
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css">
   

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> The Multi-Mission Maximum Likelihood framework
          

          
            
            <img src="../../_static/logo.png" class="logo" alt="Logo"/>
          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../notebooks/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../intro.html">Intro</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../notebooks/configuration.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../notebooks/logging.html">Logging and Verbosity</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../xspec_users.html">Notes for XSPEC Users</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../notebooks/Bayesian_tutorial.html">Bayesian Posterior Sampling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../plugins.html">Plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../modeling.html">Modeling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/API.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/API.html#threeml">threeML</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../release_notes.html">Release Notes</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Features and examples:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../notebooks/Analysis_results_showcase.html">Analysis Results</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../notebooks/random_variates.html">Random Variates</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../notebooks/Point_source_plotting.html">Point source plotting basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../notebooks/Building_Plugins_from_TimeSeries.html">Constructing plugins from TimeSeries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../notebooks/grb080916C.html">Analyzing GRB 080916C</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../notebooks/joint_BAT_gbm_demo.html">Example joint fit between GBM and Swift BAT</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../notebooks/joint_fitting_xrt_and_gbm_xspec_models.html">Joint fitting XRT and GBM data with XSPEC models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../notebooks/flux_examples.html">Point Source Fluxes and Multiple Sources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../notebooks/Time-energy-fit.html">Time-energy fit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../notebooks/synthetic_spectra.html">Generating Synthetic Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../notebooks/gof_lrt.html">Goodness of Fit and Model Comparison</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../notebooks/APEC_doc.html">Fitting XMM-Newton data with the APEC model</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">The Multi-Mission Maximum Likelihood framework</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
  <!--
  <div class="admonition note">
    <p><a href="https://github.com/lukelbd">ProPlot author here</a>: Due to my day job as a graduate student, certain <a href="https://github.com/lukelbd/proplot/pulls?q=is%3Aopen+is%3Apr">feature additions</a> may be delayed to the summer of 2020. In the meantime, if you are interested in contributing to ProPlot, please see the <a href="https://proplot.readthedocs.io/en/latest/contributions.html">contribution guide</a>. Any amount of help is welcome!
    </p>
  </div>
  -->
  <li id="lightdark-li">
    <label for="lightdark-checkbox" id="lightdark-label">
      <input type="checkbox" id="lightdark-checkbox"/>
      <div class="btn-neutral"></div>
    </label>
  </li>
  
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>jupyter:
jupytext:
formats: ipynb,md
text_representation:
extension: .md
format_name: markdown
format_version: ‘1.2’
jupytext_version: 1.7.1
kernelspec:
display_name: Python 3
language: python
name: python3</li>
    

    
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
  <script type="text/javascript" src=../../_static/custom.js></script>
  
           <div itemprop="articleBody">
            
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<hr class="docutils" />
<div class="section" id="jupyter-jupytext-formats-ipynb-md-text-representation-extension-md-format-name-markdown-format-version-1-2-jupytext-version-1-7-1-kernelspec-display-name-python-3-language-python-name-python3">
<h1>jupyter:
jupytext:
formats: ipynb,md
text_representation:
extension: .md
format_name: markdown
format_version: ‘1.2’
jupytext_version: 1.7.1
kernelspec:
display_name: Python 3
language: python
name: python3<a class="headerlink" href="#jupyter-jupytext-formats-ipynb-md-text-representation-extension-md-format-name-markdown-format-version-1-2-jupytext-version-1-7-1-kernelspec-display-name-python-3-language-python-name-python3" title="Permalink to this headline">¶</a></h1>
<!-- #region --></div>
<div class="section" id="point-source-fluxes-and-multiple-sources">
<h1>Point Source Fluxes and Multiple Sources<a class="headerlink" href="#point-source-fluxes-and-multiple-sources" title="Permalink to this headline">¶</a></h1>
<p>Once one has computed a spectral to a point source, getting the flux of that source is possible.
In 3ML, we can obtain flux in a variety of units in a live analysis or from saved fits. There is no need to know exactly what you want to obtain at the time you do the fit.</p>
<p>Also, let’s explore how to deal with fitting multiple point sources and linking of parameters.</p>
<p>Let’s explore the possibilites.</p>
<!-- #endregion --><div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">capture</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="n">np</span><span class="o">.</span><span class="n">seterr</span><span class="p">(</span><span class="nb">all</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">astropy.units</span> <span class="k">as</span> <span class="nn">u</span>
<span class="kn">from</span> <span class="nn">threeML</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">threeML.utils.OGIP.response</span> <span class="kn">import</span> <span class="n">OGIPResponse</span>
<span class="kn">from</span> <span class="nn">threeML.io.package_data</span> <span class="kn">import</span> <span class="n">get_path_of_data_file</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">jupyterthemes</span> <span class="kn">import</span> <span class="n">jtplot</span>
<span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
<span class="n">jtplot</span><span class="o">.</span><span class="n">style</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="s2">&quot;talk&quot;</span><span class="p">,</span> <span class="n">fscale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ticks</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">grid</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">silence_warnings</span><span class="p">()</span>
<span class="n">set_threeML_style</span><span class="p">()</span>
</pre></div>
</div>
<!-- #region --><div class="section" id="generating-some-synthetic-data">
<h2>Generating some synthetic data<a class="headerlink" href="#generating-some-synthetic-data" title="Permalink to this headline">¶</a></h2>
<p><img alt="alt text" src="http://aasnova.org/wp-content/uploads/2016/03/fig16.jpg" /></p>
<p>Let’s say we have two galactic x-ray sources, some accreting compact binaries perhaps? We observe them at two different times. These sources (imaginary) sources emit a blackbody which is theorized to always be at the same temperature, but perhaps at different flux levels.</p>
<p>Lets simulate one of these sources:</p>
<!-- #endregion --><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1234</span><span class="p">)</span>

<span class="c1"># we will use a demo response</span>
<span class="n">response_1</span> <span class="o">=</span> <span class="n">OGIPResponse</span><span class="p">(</span><span class="n">get_path_of_data_file</span><span class="p">(</span><span class="s2">&quot;datasets/ogip_powerlaw.rsp&quot;</span><span class="p">))</span>


<span class="n">source_function_1</span> <span class="o">=</span> <span class="n">Blackbody</span><span class="p">(</span><span class="n">K</span><span class="o">=</span><span class="mf">5e-8</span><span class="p">,</span> <span class="n">kT</span><span class="o">=</span><span class="mf">500.0</span><span class="p">)</span>
<span class="n">background_function_1</span> <span class="o">=</span> <span class="n">Powerlaw</span><span class="p">(</span><span class="n">K</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">index</span><span class="o">=-</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">piv</span><span class="o">=</span><span class="mf">1.0e3</span><span class="p">)</span>


<span class="n">spectrum_generator_1</span> <span class="o">=</span> <span class="n">DispersionSpectrumLike</span><span class="o">.</span><span class="n">from_function</span><span class="p">(</span>
    <span class="s2">&quot;s1&quot;</span><span class="p">,</span>
    <span class="n">source_function</span><span class="o">=</span><span class="n">source_function_1</span><span class="p">,</span>
    <span class="n">background_function</span><span class="o">=</span><span class="n">background_function_1</span><span class="p">,</span>
    <span class="n">response</span><span class="o">=</span><span class="n">response_1</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">spectrum_generator_1</span><span class="o">.</span><span class="n">view_count_spectrum</span><span class="p">()</span>
</pre></div>
</div>
<p>Now let’s simulate the other source, but this one has an extra feature! There is a power law component in addition to the blackbody.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
<span class="n">response_2</span> <span class="o">=</span> <span class="n">OGIPResponse</span><span class="p">(</span><span class="n">get_path_of_data_file</span><span class="p">(</span><span class="s2">&quot;datasets/ogip_powerlaw.rsp&quot;</span><span class="p">))</span>


<span class="n">source_function_2</span> <span class="o">=</span> <span class="n">Blackbody</span><span class="p">(</span><span class="n">K</span><span class="o">=</span><span class="mf">1e-7</span><span class="p">,</span> <span class="n">kT</span><span class="o">=</span><span class="mf">500.0</span><span class="p">)</span> <span class="o">+</span> <span class="n">Powerlaw_flux</span><span class="p">(</span><span class="n">F</span><span class="o">=</span><span class="mf">2e2</span><span class="p">,</span> <span class="n">index</span><span class="o">=-</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
<span class="n">background_function_2</span> <span class="o">=</span> <span class="n">Powerlaw</span><span class="p">(</span><span class="n">K</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">index</span><span class="o">=-</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">piv</span><span class="o">=</span><span class="mf">1.0e3</span><span class="p">)</span>


<span class="n">spectrum_generator_2</span> <span class="o">=</span> <span class="n">DispersionSpectrumLike</span><span class="o">.</span><span class="n">from_function</span><span class="p">(</span>
    <span class="s2">&quot;s2&quot;</span><span class="p">,</span>
    <span class="n">source_function</span><span class="o">=</span><span class="n">source_function_2</span><span class="p">,</span>
    <span class="n">background_function</span><span class="o">=</span><span class="n">background_function_2</span><span class="p">,</span>
    <span class="n">response</span><span class="o">=</span><span class="n">response_2</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">spectrum_generator_2</span><span class="o">.</span><span class="n">view_count_spectrum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="make-the-model">
<h2>Make the model<a class="headerlink" href="#make-the-model" title="Permalink to this headline">¶</a></h2>
<p>Now let’s make the model we will use to fit the data. First, let’s make the spectral function for source_1 and set priors on the parameters.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">spectrum_1</span> <span class="o">=</span> <span class="n">Blackbody</span><span class="p">()</span>

<span class="n">spectrum_1</span><span class="o">.</span><span class="n">K</span><span class="o">.</span><span class="n">prior</span> <span class="o">=</span> <span class="n">Log_normal</span><span class="p">(</span><span class="n">mu</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">1e-7</span><span class="p">),</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">spectrum_1</span><span class="o">.</span><span class="n">kT</span><span class="o">.</span><span class="n">prior</span> <span class="o">=</span> <span class="n">Log_normal</span><span class="p">(</span><span class="n">mu</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">300</span><span class="p">),</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="n">ps1</span> <span class="o">=</span> <span class="n">PointSource</span><span class="p">(</span><span class="s2">&quot;src1&quot;</span><span class="p">,</span> <span class="n">ra</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">dec</span> <span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">spectral_shape</span><span class="o">=</span><span class="n">spectrum_1</span><span class="p">)</span>
</pre></div>
</div>
<p>We will do the same for the other source but also include the power law component</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">spectrum_2</span> <span class="o">=</span> <span class="n">Blackbody</span><span class="p">()</span> <span class="o">+</span> <span class="n">Powerlaw_flux</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span> <span class="c1"># a,b are the bounds for the flux for this model</span>

<span class="n">spectrum_2</span><span class="o">.</span><span class="n">K_1</span><span class="o">.</span><span class="n">prior</span> <span class="o">=</span> <span class="n">Log_normal</span><span class="p">(</span><span class="n">mu</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">1e-6</span><span class="p">),</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">spectrum_2</span><span class="o">.</span><span class="n">kT_1</span><span class="o">.</span><span class="n">prior</span> <span class="o">=</span> <span class="n">Log_normal</span><span class="p">(</span><span class="n">mu</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">300</span><span class="p">),</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="n">spectrum_2</span><span class="o">.</span><span class="n">F_2</span><span class="o">.</span><span class="n">prior</span> <span class="o">=</span> <span class="n">Log_normal</span><span class="p">(</span><span class="n">mu</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">1e2</span><span class="p">),</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">spectrum_2</span><span class="o">.</span><span class="n">F_2</span><span class="o">.</span><span class="n">bounds</span> <span class="o">=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

<span class="n">spectrum_2</span><span class="o">.</span><span class="n">index_2</span><span class="o">.</span><span class="n">prior</span> <span class="o">=</span> <span class="n">Gaussian</span><span class="p">(</span><span class="n">mu</span><span class="o">=-</span><span class="mf">1.</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">spectrum_2</span><span class="o">.</span><span class="n">index_2</span><span class="o">.</span><span class="n">bounds</span> <span class="o">=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

<span class="n">ps2</span> <span class="o">=</span> <span class="n">PointSource</span><span class="p">(</span><span class="s2">&quot;src2&quot;</span><span class="p">,</span> <span class="n">ra</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">dec</span><span class="o">=-</span><span class="mi">10</span><span class="p">,</span> <span class="n">spectral_shape</span><span class="o">=</span><span class="n">spectrum_2</span><span class="p">)</span>
</pre></div>
</div>
<p>Now we can combine these two sources into our model.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">ps1</span><span class="p">,</span> <span class="n">ps2</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="linking-parameters">
<h3>Linking parameters<a class="headerlink" href="#linking-parameters" title="Permalink to this headline">¶</a></h3>
<p>We hypothesized that both sources should have the a same blackbody temperature. We can impose this by linking the temperatures.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">model</span><span class="o">.</span><span class="n">link</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">src1</span><span class="o">.</span><span class="n">spectrum</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">Blackbody</span><span class="o">.</span><span class="n">kT</span><span class="p">,</span> 
           <span class="n">model</span><span class="o">.</span><span class="n">src2</span><span class="o">.</span><span class="n">spectrum</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">composite</span><span class="o">.</span><span class="n">kT_1</span><span class="p">)</span>
</pre></div>
</div>
<p>we could also link the parameters with an arbitrary function rather than directly. Check out the <a class="reference external" href="https://astromodels.readthedocs.io/en/latest/Model_tutorial.html#linking-parameters">astromodels documentation</a> for more details.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">model</span>
</pre></div>
</div>
</div>
<div class="section" id="assigning-sources-to-plugins">
<h3>Assigning sources to plugins<a class="headerlink" href="#assigning-sources-to-plugins" title="Permalink to this headline">¶</a></h3>
<p>Now, if we simply passed out model to the BayesianAnalysis or JointLikelihood objects, it would sum the point source spectra together and apply both sources to all data.</p>
<p>This is not what we want. Many plugins have the ability to be assigned directly to a source. Let’s do that here:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">spectrum_generator_1</span><span class="o">.</span><span class="n">assign_to_source</span><span class="p">(</span><span class="s2">&quot;src1&quot;</span><span class="p">)</span>

<span class="n">spectrum_generator_2</span><span class="o">.</span><span class="n">assign_to_source</span><span class="p">(</span><span class="s2">&quot;src2&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Now we simply make our our data list</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">DataList</span><span class="p">(</span><span class="n">spectrum_generator_1</span><span class="p">,</span> <span class="n">spectrum_generator_2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="fitting-the-data">
<h2>Fitting the data<a class="headerlink" href="#fitting-the-data" title="Permalink to this headline">¶</a></h2>
<p>Now we fit the data as we normally would. We use Bayesian analysis here.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ba</span> <span class="o">=</span> <span class="n">BayesianAnalysis</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
<span class="n">ba</span><span class="o">.</span><span class="n">set_sampler</span><span class="p">(</span><span class="s2">&quot;ultranest&quot;</span><span class="p">)</span>
<span class="n">ba</span><span class="o">.</span><span class="n">sampler</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="n">frac_remain</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">ba</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span>
</pre></div>
</div>
<p>Let’s examine the fits.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">display_spectrum_model_counts</span><span class="p">(</span><span class="n">ba</span><span class="p">);</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">get_axes</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mf">1e-6</span><span class="p">)</span>
</pre></div>
</div>
<p>Lets grab the result. Remember, we can save the results to disk, so all of the following operations can be run at a later time without having to redo all the above steps!</p>
<div class="highlight-python tags=[&quot;nbsphinx-thumbnail&quot;] notranslate"><div class="highlight"><pre><span></span>result = ba.results
fig = result.corner_plot();
</pre></div>
</div>
</div>
<div class="section" id="computing-fluxes">
<h2>Computing fluxes<a class="headerlink" href="#computing-fluxes" title="Permalink to this headline">¶</a></h2>
<p>Now we will compute fluxes. We can compute them an many different units, over any energy range also specified in any units.</p>
<p>The flux is computed by integrating the function over energy. By default, a fast trapezoid method is used. If you need more accuracy, you can change the method in the configuration.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">threeML_config</span><span class="o">.</span><span class="n">point_source</span><span class="o">.</span><span class="n">integrate_flux_method</span> <span class="o">=</span> <span class="s2">&quot;quad&quot;</span>

<span class="n">result</span><span class="o">.</span><span class="n">get_flux</span><span class="p">(</span><span class="n">ene_min</span><span class="o">=</span><span class="mi">1</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">keV</span><span class="p">,</span> 
                <span class="n">ene_max</span> <span class="o">=</span> <span class="mi">1</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">MeV</span><span class="p">,</span>
                
                <span class="n">flux_unit</span><span class="o">=</span><span class="s2">&quot;erg/cm2/s&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>We see that a pandas dataframe is returned with all the information. We could change the confidence region for the uncertainties if we desire. However, we could also sum the source fluxes! 3ML will take care of propagating the uncertainties (for any of these operations).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">threeML_config</span><span class="o">.</span><span class="n">point_source</span><span class="o">.</span><span class="n">integrate_flux_method</span> <span class="o">=</span> <span class="s2">&quot;trapz&quot;</span>

<span class="n">result</span><span class="o">.</span><span class="n">get_flux</span><span class="p">(</span><span class="n">ene_min</span><span class="o">=</span><span class="mi">1</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">keV</span><span class="p">,</span> 
                <span class="n">ene_max</span> <span class="o">=</span> <span class="mi">1</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">MeV</span><span class="p">,</span>
                <span class="n">confidence_level</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span>
                <span class="n">sum_sources</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">flux_unit</span><span class="o">=</span><span class="s2">&quot;erg/cm2/s&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>We can get the fluxes of individual components:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">result</span><span class="o">.</span><span class="n">get_flux</span><span class="p">(</span><span class="n">ene_min</span><span class="o">=</span><span class="mi">10</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">keV</span><span class="p">,</span> 
                <span class="n">ene_max</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">MeV</span><span class="p">,</span>
                <span class="n">use_components</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">flux_unit</span><span class="o">=</span><span class="s2">&quot;1/(cm2 s)&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>As well as choose which component to compute</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">result</span><span class="o">.</span><span class="n">get_flux</span><span class="p">(</span><span class="n">ene_min</span><span class="o">=</span><span class="mi">10</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">keV</span><span class="p">,</span> 
                <span class="n">ene_max</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">MeV</span><span class="p">,</span>
                <span class="n">use_components</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">components_to_use</span> <span class="o">=</span><span class="p">[</span><span class="s2">&quot;Blackbody&quot;</span><span class="p">],</span>
                
                <span class="n">flux_unit</span><span class="o">=</span><span class="s2">&quot;erg2/(cm2 s)&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Finally, the returned flux object is a pandas table and can be manipulated as such:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">flux</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">get_flux</span><span class="p">(</span><span class="n">ene_min</span><span class="o">=</span><span class="mi">1</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">keV</span><span class="p">,</span> 
                <span class="n">ene_max</span> <span class="o">=</span> <span class="mi">1</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">MeV</span><span class="p">,</span>
                <span class="n">flux_unit</span><span class="o">=</span><span class="s2">&quot;erg/cm2/s&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">flux</span><span class="p">[</span><span class="s2">&quot;flux&quot;</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">flux</span><span class="p">[</span><span class="s2">&quot;flux&quot;</span><span class="p">][</span><span class="s2">&quot;src1: total&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>

          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2017--2021, G.Vianello, J. M. Burgess, N. Di Lalla, N. Omodei, H. Fleischhack.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>