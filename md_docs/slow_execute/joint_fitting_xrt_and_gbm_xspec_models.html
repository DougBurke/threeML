

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>jupyter: jupytext: formats: ipynb,md text_representation: extension: .md format_name: markdown format_version: ‘1.2’ jupytext_version: 1.7.1 kernelspec: display_name: Python 3 language: python name: python3 &mdash; The Multi-Mission Maximum Likelihood framework  documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/gallery.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/@jupyter-widgets/html-manager@^0.21.0-alpha.0/dist/embed-amd.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
  <link rel="stylesheet" href="../../_static/pygments/default.css" type="text/css" id="pygments-style">
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css">
   

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> The Multi-Mission Maximum Likelihood framework
          

          
            
            <img src="../../_static/logo.png" class="logo" alt="Logo"/>
          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../notebooks/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../intro.html">Intro</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../notebooks/configuration.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../notebooks/logging.html">Logging and Verbosity</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../xspec_users.html">Notes for XSPEC Users</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../notebooks/Bayesian_tutorial.html">Bayesian Posterior Sampling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../plugins.html">Plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../modeling.html">Modeling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/API.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/API.html#threeml">threeML</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../release_notes.html">Release Notes</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Features and examples:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../notebooks/Analysis_results_showcase.html">Analysis Results</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../notebooks/random_variates.html">Random Variates</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../notebooks/Point_source_plotting.html">Point source plotting basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../notebooks/Building_Plugins_from_TimeSeries.html">Constructing plugins from TimeSeries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../notebooks/grb080916C.html">Analyzing GRB 080916C</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../notebooks/joint_BAT_gbm_demo.html">Example joint fit between GBM and Swift BAT</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../notebooks/joint_fitting_xrt_and_gbm_xspec_models.html">Joint fitting XRT and GBM data with XSPEC models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../notebooks/flux_examples.html">Point Source Fluxes and Multiple Sources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../notebooks/Time-energy-fit.html">Time-energy fit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../notebooks/synthetic_spectra.html">Generating Synthetic Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../notebooks/gof_lrt.html">Goodness of Fit and Model Comparison</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../notebooks/APEC_doc.html">Fitting XMM-Newton data with the APEC model</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">The Multi-Mission Maximum Likelihood framework</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
  <!--
  <div class="admonition note">
    <p><a href="https://github.com/lukelbd">ProPlot author here</a>: Due to my day job as a graduate student, certain <a href="https://github.com/lukelbd/proplot/pulls?q=is%3Aopen+is%3Apr">feature additions</a> may be delayed to the summer of 2020. In the meantime, if you are interested in contributing to ProPlot, please see the <a href="https://proplot.readthedocs.io/en/latest/contributions.html">contribution guide</a>. Any amount of help is welcome!
    </p>
  </div>
  -->
  <li id="lightdark-li">
    <label for="lightdark-checkbox" id="lightdark-label">
      <input type="checkbox" id="lightdark-checkbox"/>
      <div class="btn-neutral"></div>
    </label>
  </li>
  
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>jupyter:
jupytext:
formats: ipynb,md
text_representation:
extension: .md
format_name: markdown
format_version: ‘1.2’
jupytext_version: 1.7.1
kernelspec:
display_name: Python 3
language: python
name: python3</li>
    

    
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
  <script type="text/javascript" src=../../_static/custom.js></script>
  
           <div itemprop="articleBody">
            
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<hr class="docutils" />
<div class="section" id="jupyter-jupytext-formats-ipynb-md-text-representation-extension-md-format-name-markdown-format-version-1-2-jupytext-version-1-7-1-kernelspec-display-name-python-3-language-python-name-python3">
<h1>jupyter:
jupytext:
formats: ipynb,md
text_representation:
extension: .md
format_name: markdown
format_version: ‘1.2’
jupytext_version: 1.7.1
kernelspec:
display_name: Python 3
language: python
name: python3<a class="headerlink" href="#jupyter-jupytext-formats-ipynb-md-text-representation-extension-md-format-name-markdown-format-version-1-2-jupytext-version-1-7-1-kernelspec-display-name-python-3-language-python-name-python3" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="joint-fitting-xrt-and-gbm-data-with-xspec-models">
<h1>Joint fitting XRT and GBM data with XSPEC models<a class="headerlink" href="#joint-fitting-xrt-and-gbm-data-with-xspec-models" title="Permalink to this headline">¶</a></h1>
<div class="section" id="goals">
<h2>Goals<a class="headerlink" href="#goals" title="Permalink to this headline">¶</a></h2>
<p>3ML is designed to properly joint fit data from different instruments with thier instrument dependent likelihoods.
We demostrate this with joint fitting data from GBM and XRT while simultaneously showing hwo to use the XSPEC models form <strong>astromodels</strong></p>
</div>
<div class="section" id="setup">
<h2>Setup<a class="headerlink" href="#setup" title="Permalink to this headline">¶</a></h2>
<p>You must have you HEASARC initiated so that <strong>astromodels</strong> can find the XSPEC libraries.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="n">np</span><span class="o">.</span><span class="n">seterr</span><span class="p">(</span><span class="nb">all</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">capture</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">threeML</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">threeML.io.package_data</span> <span class="kn">import</span> <span class="n">get_path_of_data_file</span>

<span class="c1"># we will need XPSEC models for extinction</span>
<span class="kn">from</span> <span class="nn">astromodels.xspec</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">astromodels.xspec.xspec_settings</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">jupyterthemes</span> <span class="kn">import</span> <span class="n">jtplot</span>
<span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
<span class="n">jtplot</span><span class="o">.</span><span class="n">style</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="s2">&quot;talk&quot;</span><span class="p">,</span> <span class="n">fscale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ticks</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">grid</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">set_threeML_style</span><span class="p">()</span>
<span class="n">silence_warnings</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="load-xrt-data">
<h2>Load XRT data<a class="headerlink" href="#load-xrt-data" title="Permalink to this headline">¶</a></h2>
<p>Make a likelihood for the XRT including all the appropriate files</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">trigger</span><span class="o">=</span><span class="s2">&quot;GRB110731A&quot;</span>
<span class="n">dec</span><span class="o">=-</span><span class="mf">28.546</span>
<span class="n">ra</span><span class="o">=</span><span class="mf">280.52</span>

<span class="n">p</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;datasets/xrt&quot;</span><span class="p">)</span>

<span class="n">xrt</span> <span class="o">=</span> <span class="n">OGIPLike</span><span class="p">(</span><span class="s2">&quot;XRT&quot;</span><span class="p">,</span><span class="n">observation</span><span class="o">=</span> <span class="n">get_path_of_data_file</span><span class="p">(</span><span class="n">p</span> <span class="o">/</span><span class="s2">&quot;xrt_src.pha&quot;</span><span class="p">),</span>
                   <span class="n">background</span><span class="o">=</span> <span class="n">get_path_of_data_file</span><span class="p">(</span><span class="n">p</span> <span class="o">/</span><span class="s2">&quot;xrt_bkg.pha&quot;</span><span class="p">),</span>
                   <span class="n">response</span><span class="o">=</span> <span class="n">get_path_of_data_file</span><span class="p">(</span><span class="n">p</span> <span class="o">/</span><span class="s2">&quot;xrt.rmf&quot;</span><span class="p">),</span>
                   <span class="n">arf_file</span><span class="o">=</span> <span class="n">get_path_of_data_file</span><span class="p">(</span><span class="n">p</span> <span class="o">/</span><span class="s2">&quot;xrt.arf&quot;</span><span class="p">))</span>



<span class="n">fig</span> <span class="o">=</span> <span class="n">xrt</span><span class="o">.</span><span class="n">view_count_spectrum</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">get_axes</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">_</span> <span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mf">1e-1</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fit</span> <span class="o">=</span> <span class="n">xrt</span><span class="o">.</span><span class="n">view_count_spectrum</span><span class="p">(</span><span class="n">scale_background</span><span class="o">=</span><span class="kc">False</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="load-gbm-data">
<h2>Load GBM data<a class="headerlink" href="#load-gbm-data" title="Permalink to this headline">¶</a></h2>
<p>Load all the GBM data you need and make appropriate background, source time, and energy selections. Make sure to check the light curves!</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">trigger_number</span> <span class="o">=</span> <span class="s1">&#39;bn110731465&#39;</span>
<span class="n">gbm_data</span> <span class="o">=</span> <span class="n">download_GBM_trigger_data</span><span class="p">(</span><span class="n">trigger_number</span><span class="p">,</span><span class="n">detectors</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;n3&#39;</span><span class="p">])</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Select the time interval</span>
<span class="n">src_selection</span> <span class="o">=</span> <span class="s2">&quot;100.169342-150.169342&quot;</span>
<span class="n">bkg_selection</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;-25.0--10.0&quot;</span><span class="p">,</span><span class="s2">&quot;300-400&quot;</span><span class="p">]</span>
<span class="n">ts</span> <span class="o">=</span> <span class="n">TimeSeriesBuilder</span><span class="o">.</span><span class="n">from_gbm_cspec_or_ctime</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;gbm_n3&quot;</span><span class="p">,</span>
    <span class="n">cspec_or_ctime_file</span><span class="o">=</span><span class="n">gbm_data</span><span class="p">[</span><span class="s2">&quot;n3&quot;</span><span class="p">][</span><span class="s2">&quot;cspec&quot;</span><span class="p">],</span>
                                              <span class="n">rsp_file</span><span class="o">=</span><span class="n">gbm_data</span><span class="p">[</span><span class="s2">&quot;n3&quot;</span><span class="p">][</span><span class="s2">&quot;rsp&quot;</span><span class="p">]</span>
                                              <span class="p">)</span>


<span class="n">ts</span><span class="o">.</span><span class="n">set_background_interval</span><span class="p">(</span><span class="o">*</span><span class="n">bkg_selection</span><span class="p">)</span>
<span class="n">ts</span><span class="o">.</span><span class="n">save_background</span><span class="p">(</span><span class="s2">&quot;n3_bkg.h5&quot;</span><span class="p">,</span><span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">view_lightcurve</span><span class="p">(</span><span class="o">-</span><span class="mi">50</span><span class="p">,</span><span class="mi">450</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ts</span> <span class="o">=</span> <span class="n">TimeSeriesBuilder</span><span class="o">.</span><span class="n">from_gbm_tte</span><span class="p">(</span><span class="s2">&quot;gbm_n3&quot;</span><span class="p">,</span>
                                    <span class="n">tte_file</span><span class="o">=</span><span class="n">gbm_data</span><span class="p">[</span><span class="s2">&quot;n3&quot;</span><span class="p">][</span><span class="s2">&quot;tte&quot;</span><span class="p">],</span>
                                    <span class="n">rsp_file</span><span class="o">=</span><span class="n">gbm_data</span><span class="p">[</span><span class="s2">&quot;n3&quot;</span><span class="p">][</span><span class="s2">&quot;rsp&quot;</span><span class="p">],</span>
                                    <span class="n">restore_background</span><span class="o">=</span><span class="s2">&quot;n3_bkg.h5&quot;</span>
                                   
                                   <span class="p">)</span>


<span class="n">ts</span><span class="o">.</span><span class="n">set_active_time_interval</span><span class="p">(</span><span class="n">src_selection</span><span class="p">)</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">view_lightcurve</span><span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mi">160</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">nai3</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">to_spectrumlike</span><span class="p">()</span>
</pre></div>
</div>
<p>Make energy selections and check them out</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">nai3</span><span class="o">.</span><span class="n">set_active_measurements</span><span class="p">(</span><span class="s2">&quot;8-900&quot;</span><span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">nai3</span><span class="o">.</span><span class="n">view_count_spectrum</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="section" id="setup-the-model">
<h2>Setup the model<a class="headerlink" href="#setup-the-model" title="Permalink to this headline">¶</a></h2>
<p><strong>astromodels</strong> allows you to use XSPEC models if you have XSPEC installed.
Set all the normal parameters you would in XSPEC and build a model the normal <strong>3ML/astromodels</strong> way! Here we will use the <code class="docutils literal notranslate"><span class="pre">phabs</span></code> model from XSPEC and mix it with powerlaw model in astromodels.</p>
<div class="section" id="with-xspec">
<h3>With XSPEC<a class="headerlink" href="#with-xspec" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">xspec_abund</span><span class="p">(</span><span class="s1">&#39;angr&#39;</span><span class="p">)</span>

<span class="n">spectral_model</span> <span class="o">=</span>  <span class="n">XS_phabs</span><span class="p">()</span><span class="o">*</span> <span class="n">XS_zphabs</span><span class="p">()</span> <span class="o">*</span> <span class="n">Powerlaw</span><span class="p">()</span>


<span class="n">spectral_model</span><span class="o">.</span><span class="n">nh_1</span><span class="o">=</span><span class="mf">0.101</span>
<span class="n">spectral_model</span><span class="o">.</span><span class="n">nh_1</span><span class="o">.</span><span class="n">bounds</span> <span class="o">=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<span class="n">spectral_model</span><span class="o">.</span><span class="n">nh_1</span><span class="o">.</span><span class="n">fix</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">spectral_model</span><span class="o">.</span><span class="n">nh_2</span><span class="o">=</span><span class="mf">0.1114424</span>
<span class="n">spectral_model</span><span class="o">.</span><span class="n">nh_2</span><span class="o">.</span><span class="n">fix</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">spectral_model</span><span class="o">.</span><span class="n">nh_2</span><span class="o">.</span><span class="n">bounds</span> <span class="o">=</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<span class="n">spectral_model</span><span class="o">.</span><span class="n">redshift_2</span> <span class="o">=</span> <span class="mf">0.618</span>
<span class="n">spectral_model</span><span class="o">.</span><span class="n">redshift_2</span><span class="o">.</span><span class="n">fix</span> <span class="o">=</span><span class="kc">True</span>
</pre></div>
</div>
</div>
<div class="section" id="with-astromodels-phabs">
<h3>With astromodels PHABS<a class="headerlink" href="#with-astromodels-phabs" title="Permalink to this headline">¶</a></h3>
<p>We can build the exact same models in native astromodels thanks to <strong>Dominique Eckert</strong>.
Here, there is no extra function for redshifting the absorption model, just pass a redshift.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">phabs_local</span> <span class="o">=</span> <span class="n">PhAbs</span><span class="p">(</span><span class="n">NH</span><span class="o">=</span><span class="mf">0.101</span><span class="p">)</span>
<span class="n">phabs_local</span><span class="o">.</span><span class="n">NH</span><span class="o">.</span><span class="n">fix</span><span class="o">=</span><span class="kc">True</span>
<span class="n">phabs_local</span><span class="o">.</span><span class="n">redshift</span><span class="o">.</span><span class="n">fix</span><span class="o">=</span><span class="kc">True</span>
<span class="n">phabs_src</span> <span class="o">=</span> <span class="n">PhAbs</span><span class="p">(</span><span class="n">NH</span><span class="o">=</span><span class="mf">0.1114424</span><span class="p">,</span><span class="n">redshift</span><span class="o">=</span><span class="mf">0.618</span><span class="p">)</span>
<span class="n">phabs_src</span><span class="o">.</span><span class="n">NH</span><span class="o">.</span><span class="n">fix</span><span class="o">=</span><span class="kc">True</span>
<span class="n">phabs_src</span><span class="o">.</span><span class="n">redshift</span><span class="o">.</span><span class="n">fix</span><span class="o">=</span><span class="kc">True</span>
<span class="n">pl</span> <span class="o">=</span> <span class="n">Powerlaw</span><span class="p">()</span>
<span class="n">spectral_model_native</span> <span class="o">=</span> <span class="n">phabs_local</span> <span class="o">*</span> <span class="n">phabs_src</span> <span class="o">*</span> <span class="n">pl</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="setup-the-joint-likelihood">
<h2>Setup the joint likelihood<a class="headerlink" href="#setup-the-joint-likelihood" title="Permalink to this headline">¶</a></h2>
<p>Create a point source object and model.</p>
<p>Load the data into a data list and create the joint likelihood</p>
<div class="section" id="with-xspec-models">
<h3>With XSPEC models<a class="headerlink" href="#with-xspec-models" title="Permalink to this headline">¶</a></h3>
<p>First we will fit with the XSPEC model</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ptsrc</span> <span class="o">=</span> <span class="n">PointSource</span><span class="p">(</span><span class="n">trigger</span><span class="p">,</span><span class="n">ra</span><span class="p">,</span><span class="n">dec</span><span class="p">,</span><span class="n">spectral_shape</span><span class="o">=</span><span class="n">spectral_model</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">ptsrc</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="fitting">
<h4>Fitting<a class="headerlink" href="#fitting" title="Permalink to this headline">¶</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">DataList</span><span class="p">(</span><span class="n">xrt</span><span class="p">,</span><span class="n">nai3</span><span class="p">)</span>

<span class="n">jl</span> <span class="o">=</span> <span class="n">JointLikelihood</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">display</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">res</span> <span class="o">=</span> <span class="n">jl</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">display_spectrum_model_counts</span><span class="p">(</span><span class="n">jl</span><span class="p">,</span><span class="n">min_rate</span><span class="o">=</span><span class="p">[</span><span class="mf">.5</span><span class="p">,</span><span class="mf">.1</span><span class="p">]);</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">res</span> <span class="o">=</span> <span class="n">jl</span><span class="o">.</span><span class="n">get_contours</span><span class="p">(</span><span class="n">spectral_model</span><span class="o">.</span><span class="n">index_3</span><span class="p">,</span><span class="o">-</span><span class="mf">2.5</span><span class="p">,</span><span class="o">-</span><span class="mf">1.5</span><span class="p">,</span><span class="mi">50</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">_</span> <span class="o">=</span> <span class="n">jl</span><span class="o">.</span><span class="n">get_contours</span><span class="p">(</span><span class="n">spectral_model</span><span class="o">.</span><span class="n">K_3</span><span class="p">,</span><span class="mf">.1</span><span class="p">,</span><span class="mf">.3</span><span class="p">,</span><span class="mi">25</span><span class="p">,</span>
                <span class="n">spectral_model</span><span class="o">.</span><span class="n">index_3</span><span class="p">,</span><span class="o">-</span><span class="mf">2.5</span><span class="p">,</span><span class="o">-</span><span class="mf">1.5</span><span class="p">,</span><span class="mi">50</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plot_spectra</span><span class="p">(</span><span class="n">jl</span><span class="o">.</span><span class="n">results</span><span class="p">,</span><span class="n">show_legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">emin</span><span class="o">=</span><span class="mf">.01</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">keV</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="fit-with-astromodels-phabs">
<h3>Fit with astromodels PhAbs<a class="headerlink" href="#fit-with-astromodels-phabs" title="Permalink to this headline">¶</a></h3>
<p>Now lets repeat the fit in pure astromodels.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ptsrc_native</span> <span class="o">=</span> <span class="n">PointSource</span><span class="p">(</span><span class="n">trigger</span><span class="p">,</span><span class="n">ra</span><span class="p">,</span><span class="n">dec</span><span class="p">,</span><span class="n">spectral_shape</span><span class="o">=</span><span class="n">spectral_model_native</span><span class="p">)</span>
<span class="n">model_native</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">ptsrc_native</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="id1">
<h4>Fitting<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">DataList</span><span class="p">(</span><span class="n">xrt</span><span class="p">,</span><span class="n">nai3</span><span class="p">)</span>

<span class="n">jl_native</span> <span class="o">=</span> <span class="n">JointLikelihood</span><span class="p">(</span><span class="n">model_native</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">display</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python tags=[&quot;nbsphinx-thumbnail&quot;] notranslate"><div class="highlight"><pre><span></span>res = jl_native.fit()
fig = display_spectrum_model_counts(jl_native,min_rate=[.5,.1]);
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plot_spectra</span><span class="p">(</span><span class="n">jl</span><span class="o">.</span><span class="n">results</span><span class="p">,</span><span class="n">jl_native</span><span class="o">.</span><span class="n">results</span><span class="p">,</span><span class="n">show_legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">emin</span><span class="o">=</span><span class="mf">.01</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">keV</span><span class="p">);</span>
</pre></div>
</div>
<p>Both approaches give the same answer as they should.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>

          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2017--2021, G.Vianello, J. M. Burgess, N. Di Lalla, N. Omodei, H. Fleischhack.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>